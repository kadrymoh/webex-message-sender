<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Webex Message Sender</title>
<style>
  body {
    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    background: #f5f7fa;
    color: #333;
    margin: 0;
    padding: 0 20px;
  }

  h1 {
    text-align: center;
    margin-top: 30px;
    color: #0070d2;
  }

  label {
    font-weight: 600;
    margin-top: 15px;
    display: block;
  }

  input[type="text"], select {
    width: 100%;
    max-width: 480px;
    padding: 10px 12px;
    margin-top: 6px;
    border: 1.5px solid #ccc;
    border-radius: 6px;
    font-size: 16px;
    box-sizing: border-box;
    transition: border-color 0.3s ease;
  }

  input[type="text"]:focus, select:focus {
    border-color: #0070d2;
    outline: none;
  }

  button {
    margin-top: 20px;
    padding: 12px 24px;
    background-color: #0070d2;
    border: none;
    border-radius: 6px;
    color: white;
    font-weight: 600;
    font-size: 16px;
    cursor: pointer;
    transition: background-color 0.3s ease;
    max-width: 200px;
  }

  button:hover:not(:disabled) {
    background-color: #005bb5;
  }

  button:disabled {
    background-color: #a0a9b8;
    cursor: not-allowed;
  }

  #roomsArea {
    margin-top: 30px;
  }

  #status {
    margin-top: 20px;
    font-weight: 600;
  }

  @media (max-width: 520px) {
    input[type="text"], select {
      max-width: 100%;
    }
    button {
      max-width: 100%;
    }
  }
</style>
</head>
<body>

  <h1>Webex Message Sender</h1>

  <label for="patInput">Enter your Personal Access Token:</label>
  <input type="text" id="patInput" placeholder="Paste your Webex PAT here" autocomplete="off" />

  <button id="loadRoomsBtn">Load My Rooms</button>

  <div id="roomsArea" style="display:none;">
    <label for="roomsSelect">Select a room:</label>
    <select id="roomsSelect"></select>

    <label for="messageInput">Message to send:</label>
    <input type="text" id="messageInput" placeholder="Type your message here" autocomplete="off" />

    <button id="sendMessageBtn">Send Message</button>
  </div>

  <div id="status"></div>

  <script src="https://unpkg.com/webex@3.7.0/umd/webex.min.js"></script>
  <script >
    const patInput = document.getElementById('patInput');
const loadRoomsBtn = document.getElementById('loadRoomsBtn');
const roomsArea = document.getElementById('roomsArea');
const roomsSelect = document.getElementById('roomsSelect');
const messageInput = document.getElementById('messageInput');
const sendMessageBtn = document.getElementById('sendMessageBtn');
const statusDiv = document.getElementById('status');

let webex;

loadRoomsBtn.onclick = async () => {
  const token = patInput.value.trim();
  if (!token) {
    statusDiv.style.color = 'red';
    statusDiv.textContent = 'Please enter your Personal Access Token.';
    return;
  }

  try {
    statusDiv.style.color = 'black';
    statusDiv.textContent = 'Loading your rooms...';

    webex = Webex.init({
      credentials: {
        access_token: token,
      },
    });

    const roomsResponse = await webex.rooms.list();
    const rooms = roomsResponse.items;

    roomsSelect.innerHTML = '';
    rooms.forEach(room => {
      const option = document.createElement('option');
      option.value = room.id;
      option.textContent = room.title || '(No Title)';
      roomsSelect.appendChild(option);
    });

    roomsArea.style.display = 'block';
    statusDiv.style.color = 'green';
    statusDiv.textContent = 'Rooms loaded successfully! Select a room and send a message.';
  } catch (error) {
    statusDiv.style.color = 'red';
    statusDiv.textContent = 'Failed to load rooms: ' + error.message;
  }
};

sendMessageBtn.onclick = async () => {
  const roomId = roomsSelect.value;
  const text = messageInput.value.trim();

  if (!roomId) {
    statusDiv.style.color = 'red';
    statusDiv.textContent = 'Please select a room.';
    return;
  }

  if (!text) {
    statusDiv.style.color = 'red';
    statusDiv.textContent = 'Please enter a message.';
    return;
  }

  try {
    sendMessageBtn.disabled = true;
    statusDiv.style.color = 'black';
    statusDiv.textContent = 'Sending message...';

    await webex.messages.create({
      roomId: roomId,
      text: text,
    });

    statusDiv.style.color = 'green';
    statusDiv.textContent = 'Message sent successfully!';
    messageInput.value = '';
  } catch (error) {
    statusDiv.style.color = 'red';
    statusDiv.textContent = 'Failed to send message: ' + error.message;
  } finally {
    sendMessageBtn.disabled = false;
  }
};

  </script>

</body>
</html>
